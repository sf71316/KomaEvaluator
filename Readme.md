# KomaEvaluator - å¤§è¦æ¨¡æ¼«ç•«ç•«é¢¨åˆ†é¡ç³»çµ±

**KomaEvaluator** æ˜¯ä¸€å€‹å°ˆç‚ºå¤§è¦æ¨¡æ¼«ç•«åœ–åƒåˆ†é¡è¨­è¨ˆçš„æ·±åº¦å­¸ç¿’å°ˆæ¡ˆã€‚å®ƒèƒ½å¤ è‡ªå‹•åŒ–åœ°å¾åŸå§‹æ¼«ç•«æª”æ¡ˆä¸­æå–ç‰¹å¾µï¼ˆäººè‡‰èˆ‡ç´‹ç†ï¼‰ï¼Œä¸¦è¨“ç·´å‡ºé«˜æº–ç¢ºåº¦çš„ç•«é¢¨è­˜åˆ¥æ¨¡å‹ã€‚

æœ¬ç³»çµ±ç‰¹åˆ¥é‡å° **200 ä½ä»¥ä¸Šä½œè€…**ã€**æ•¸è¬å¼µåœ–ç‰‡** çš„é‡ç´šé€²è¡Œäº†å„ªåŒ–ï¼Œå…·å‚™å·¥æ¥­ç´šçš„è³‡æ–™æ¸…æ´—ã€å¤šé€²ç¨‹åŠ é€Ÿèˆ‡ä¸­æ–·æ¢å¾©èƒ½åŠ›ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹è‰²

*   **ğŸš€ å¤§è¦æ¨¡é«˜æ•ˆèƒ½**ï¼š
    *   **å¤šé€²ç¨‹é è™•ç†**ï¼š`crop_faces.py` èˆ‡ `prepare_patches.py` æ”¯æ´å¤šæ ¸å¿ƒä¸¦è¡Œè™•ç†ï¼Œé€Ÿåº¦æå‡ 10 å€ä»¥ä¸Šã€‚
    *   **æ··åˆç²¾åº¦è¨“ç·´ (AMP)**ï¼šæ”¯æ´ FP16/BF16ï¼Œå¤§å¹…é™ä½é¡¯å­˜éœ€æ±‚ä¸¦åŠ é€Ÿè¨“ç·´ã€‚
*   **ğŸ›¡ï¸ ç©©å¥çš„è¨“ç·´æµç¨‹**ï¼š
    *   **ä¸­æ–·æ¢å¾© (Resume)**ï¼šè¨“ç·´é€”ä¸­ç•¶æ©Ÿæˆ–ä¸­æ–· (`Ctrl+C`)ï¼Œå¯éš¨æ™‚å¾ Checkpoint æ¢å¾©ï¼Œç„¡éœ€é‡é ­å†ä¾†ã€‚
    *   **è‡ªå‹•è³‡æ–™æ¸…æ´—**ï¼šå…§å»º `check_dataset_health.py` æƒæå£æª”ï¼Œ`prepare_dataset.py` æ”¯æ´äº’å‹•å¼ç™½åå–®éæ¿¾ã€‚
*   **ğŸ”„ å¢é‡è¨“ç·´æ©Ÿåˆ¶**ï¼š
    *   æ™ºæ…§è¨˜éŒ„å·²è¨“ç·´éçš„ä½œè€…ï¼Œå†æ¬¡æº–å‚™è³‡æ–™æ™‚è‡ªå‹•åŸ·è¡Œ **æ¸›é‡æ¡æ¨£ (20%)**ï¼Œå¤§å¹…ç¯€çœç¡¬ç¢Ÿç©ºé–“èˆ‡è¨“ç·´æ™‚é–“ã€‚
*   **ğŸ§  å…ˆé€²æ¨¡å‹æ¶æ§‹**ï¼š
    *   é è¨­æ¡ç”¨ **ConvNeXt V2** (Tiny/Base) æ¨¡å‹ï¼Œé‡å°æ¼«ç•«ç·šæ¢èˆ‡ç¶²é»ç‰¹å¾µæœ‰æ¥µä½³çš„è¡¨ç¾ã€‚
    *   æ”¯æ´ **Top-5 Accuracy** è©•ä¼°ï¼Œåœ¨æ•¸ç™¾å€‹é¡åˆ¥ä¸­æä¾›æ›´å®¢è§€çš„æŒ‡æ¨™ã€‚

## ğŸ› ï¸ å¿«é€Ÿé–‹å§‹

è©³ç´°æ“ä½œè«‹åƒé–± [ğŸ“– æ“ä½œæ‰‹å†Š (USER_GUIDE.md)](USER_GUIDE.md)ã€‚

### 1. ç’°å¢ƒå®‰è£
```bash
pip install -r requirements.txt
```

### 2. è³‡æ–™æº–å‚™ (Data Preparation)
å°‡åŸå§‹ä½œè€…è³‡æ–™å¤¾æ”¾å…¥ `MangaOriginalData/`ï¼Œç„¶å¾ŒåŸ·è¡Œï¼š
```bash
# äº’å‹•å¼è…³æœ¬ï¼šè‡ªå‹•æƒæã€å»ºç«‹ç™½åå–®ã€è©•ä¼°ç¡¬ç¢Ÿç©ºé–“
python prepare_dataset.py --num_samples_per_artist 400
```

### 3. è³‡æ–™é è™•ç† (Preprocessing)
æå–äººè‡‰èˆ‡ç´‹ç†ç‰¹å¾µï¼Œä¸¦åˆä½µç‚ºæœ€çµ‚è³‡æ–™é›†ï¼š
```bash
# 1. äººè‡‰è£åˆ‡
python crop_faces.py --src_dir Manga_Dataset_Clean --dst_dir Manga_Dataset_Faces --num_workers 8

# 2. ç´‹ç†æå– (å¯é¸)
python prepare_patches.py --src_dir Manga_Dataset_Clean --dst_dir Manga_Dataset_Patches --num_workers 8

# 3. åˆä½µè³‡æ–™é›†
python merge_and_split.py --dirs Manga_Dataset_Faces Manga_Dataset_Patches --dst_dir Manga_Dataset_Mixed
```

### 4. æ¨¡å‹è¨“ç·´ (Training)
```bash
# ä½¿ç”¨åˆä½µå¾Œçš„è³‡æ–™é›†é€²è¡Œè¨“ç·´
python train.py --data_dir Manga_Dataset_Mixed --model convnext_v2_tiny_local --epochs 50 --record_history
```

### 5. éƒ¨ç½² (Deployment)
```bash
# åŒ¯å‡ºç‚º ONNX
python export_to_onnx.py --model_path DL_Output_Models/.../final_model.pth ...
```
æœ¬å°ˆæ¡ˆåŒ…å«ä¸€å€‹ `CSharpPredict` ç›®éŒ„ï¼Œæä¾›åœ¨ .NET ç’°å¢ƒä¸‹è¼‰å…¥ ONNX æ¨¡å‹é€²è¡Œé æ¸¬çš„ç¯„ä¾‹ã€‚

## ğŸ“‚ ç›®éŒ„çµæ§‹

*   `MangaOriginalData/`: åŸå§‹è³‡æ–™å­˜æ”¾å€
*   `Manga_Dataset_Clean/`: æ¸…æ´—å¾Œçš„åœ–ç‰‡
*   `Manga_Dataset_Faces/`: äººè‡‰ç‰¹å¾µè³‡æ–™é›†
*   `DL_Output_Models/`: è¨“ç·´è¼¸å‡º (æ¨¡å‹èˆ‡ Checkpoints)
*   `USER_GUIDE.md`: **å®Œæ•´æ“ä½œèªªæ˜æ›¸**

## ğŸ“ æˆæ¬Š
MIT License